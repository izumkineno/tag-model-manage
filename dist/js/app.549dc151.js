(function(){"use strict";var t={1021:function(t,e,n){var i=n(9963),o=n(4717),l=(n(3241),n(1613),n(4408)),r=(n(9290),n(4545)),a=(n(1448),n(5064)),c=(n(7891),n(5381)),s=(n(8538),n(3176)),d=(n(463),n(7583)),u=(n(444),n(6252)),p=n(2262),g=n(3577),h=n(32),f=(n(1154),n(7720));const m=(0,f.Q_)("main",{persist:!0,state:()=>({config:{sym:[["(",")"],["[","]"]],switch:{autoStart:{name:"自动开始",active:!1}}},prompt:[{id:"0",name:"这里创建提示词",state:{active:!1,editing:!1,weightEditing:!1},weight:0,longText:!1,children:[]}],promptNeg:[{id:"1",name:"这里创建负面提示词",state:{active:!1,editing:!1,weightEditing:!1},weight:0,longText:!1,children:[]}]}),actions:{clickHandle(t,e,n){const i=t.ctrlKey,o=t.altKey,l=["click","contextmenu"],r=(i?o?3:1:o?2:0)+4*l.indexOf(t.type),a={0:()=>this.switch(t,e,n),1:()=>this.inputFocus(t,e,"editing",n),2:()=>this.inputFocus(t,e,"weightEditing",n),3:()=>this.delete(t,e,n),4:()=>this.contextmenu(),5:()=>this.add(t,e,n),6:()=>this.add(t,e,n),7:()=>this.longTextMode()},c=a[r];c()},pos(t,e,n,i,o){const l=t.parentElement.__draggable_component__||t.__draggable_component__,r=t.__draggable_context,a=e||Array.from(l.itemKey);let c="undefined"===typeof r?a:a.concat(r.index);i&&(c=c.slice(0,c.length-1));let s=this[n];for(let d=0;d<c.length;d++){const t=c[d],e=s[t].children;"undefined"!==typeof e&&(s=e)}return i&&o&&r?s[r.index]:s},tagModel(){const t=""+Math.random().toString(36).slice(-8);return{id:t,longText:!1,name:t,state:{active:!0,editing:!0,weightEditing:!1},weight:0}},input(t,e,n,i){const o=this.pos(t.target,e,i,!0,!0);return!(!("state"in o)||!o.state)&&(o.state[n]=!o.state[n],!0)},inputFocus(t,e,n,i){this.input(t,e,n,i)&&(0,u.Y3)((()=>{t.target&&t.target.children[0].focus()}))},switch(t,e,n){const i=this.pos(t.target,e,n,!0,!0);"state"in i&&i.state&&(i.state.active=!i.state.active)},editingInput(t){t.name=t.name.trim(),t.state.editing=!1},editingInputMulti(t,e,n){if(t.name=t.name.trim(),-1!==t.name.search(",")){const i=t.name.split(",");let o=this[n];for(const t of e)o&&(o=o[t].children);if(console.log(o,e),o){const e=o.indexOf(t);console.log(o,t,e),o.splice(e,1);for(const t of i)if(t.length>0){const e=this.tagModel();e.name=t,e.state.editing=!1,o.push(e)}}}this.editingInput(t)},delete(t,e,n){const i=t.target.__draggable_context;if(i){const{index:o}=i,l=this.pos(t.target,e,n,!0);Array.isArray(l)?l.splice(o,1):l.children&&l.children.splice(o,1)}},weightInput(t){t.state.weightEditing=!1;const e=t.weight.toString();"string"===typeof t.weight&&(t.weight=0),t.weight>0&&t.weight<2&&e.length>1?t.weightNu=t.weight:(t.weightNu=void 0,t.weight=Number(t.weight.toFixed(0)))},add(t,e,n){const i=this.tagModel();t.altKey&&(i.children=[]);const o=this.pos(t.target,e,n),l=o,r=o;"undefined"!==typeof l.children?l.children.push(i):r.push(i),(0,u.Y3)((()=>{const e="undefined"!==typeof t.target.__draggable_component__,n="undefined"!==typeof t.target.__draggable_context;if(e||n){const n=t.target.lastChild.children;if(e)n[0].focus(),n[0].select();else{const e=t.target.parentElement.children,i=e[e.length-1];i.children[0].focus(),"undefined"!==typeof n&&(n[n.length-1].firstChild.focus(),n[n.length-1].firstChild.select())}}}))},output(){const t=(t,e)=>{const n=this.config.sym;let i;if("undefined"!==typeof t.weightNu){const o=t.weightNu;i=`${n[0][0]}${e}:${o}${n[0][1]}`}else{let o=t.weight;if(0===o)i=e;else{const t=o>0?n[0]:n[1];o=Math.abs(o);const l=e.length;i=e.padStart(l+o,t[0]).padEnd(l+2*o,t[1])}}return i},e=n=>{const i=[];return n.forEach((n=>{if(n.state.active){let o;o="undefined"===typeof n.children?t(n,n.name):t(n,e(n.children)),o.length>0&&i.push(o)}})),i.join(",")},n=e(this.prompt),i=e(this.promptNeg);console.log(n),console.log(i);try{const t=gradio_config.components;if(t){const e=[];t.forEach(((n,i)=>{if("textbox"===n.type){const o=n.props;"txt2img_prompt"===o.elem_id&&"Prompt"===o.label&&e.push(t[i]),"txt2img_neg_prompt"===o.elem_id&&"Negative prompt"===o.label&&e.push(t[i])}})),console.log(e),e[0].props.value=n,e[1].props.value=i,this.config.switch.autoStart.active&&document.querySelector("body > gradio-app").shadowRoot.querySelector("#txt2img_generate").click()}}catch(o){console.log(o)}},contextmenu(){console.log("菜单")},longTextMode(){console.log("长文本模式")}}});var y=n(9980),w=n.n(y);const v=["onUpdate:modelValue","onBlur","onKeyup"],_=["onUpdate:modelValue","onBlur","onKeyup"],S={key:2,style:{display:"inline-block",visibility:"hidden"}},x={key:3};var b=(0,u.aZ)({__name:"nested-item",props:{children:null,type:null,index:null},setup(t){const e=t,n=m(),o={animation:200,group:"description",disabled:!1,ghostClass:"ghost"},l=(0,u.Fl)((()=>"undefined"===typeof e.index?[]:e.index)),r=t=>{const e=t.state.editing?"editing ":"",n=t.state.weightEditing?"weight ":"",i=t.state.active?"":"off ",o="undefined"!==typeof t.children?"group ":"";return o+i+e+n},a=t=>{const e=t=>.7*t+.3,n={};let i;if("undefined"!==typeof t.weightNu){const n=t.weightNu;i=n>1?`rgba(0, 200, 0, ${e(n-1)}`:`rgba(200, 0, 0, ${e(1-n)})`}else{const n=t.weight;i=0===n?"":n>0?`rgba(0, 200, 0, ${e(1.1**n-1)})`:`rgba(200, 0, 0, ${e(1-1/1.1**-n)})`}return i.length>0&&(n.background=i),n};return(c,s)=>{const d=(0,u.up)("NestedItem",!0);return(0,u.wg)(),(0,u.j4)((0,p.SU)(w()),(0,u.dG)({"item-key":"undefined"===typeof e.index?"":(0,p.SU)(l).toString(),list:t.children,class:"dragArea",tag:"ul"},o,{onClick:[s[1]||(s[1]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["stop","exact"])),s[2]||(s[2]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["stop","exact","ctrl"])),s[3]||(s[3]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["stop","exact","alt"])),s[4]||(s[4]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["stop","exact","ctrl","alt"]))],onContextmenu:[s[5]||(s[5]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["prevent","stop","exact"])),s[6]||(s[6]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["prevent","stop","exact","ctrl"])),s[7]||(s[7]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["prevent","stop","exact","alt"])),s[8]||(s[8]=(0,i.iM)((e=>(0,p.SU)(n).clickHandle(e,(0,p.SU)(l),t.type)),["prevent","stop","exact","ctrl","alt"]))]}),{item:(0,u.w5)((({element:o})=>[(0,u._)("li",{class:(0,g.C_)([r(o),"tag-frame"]),style:(0,g.j5)(a(o))},[o.state.editing?(0,u.wy)(((0,u.wg)(),(0,u.iD)("input",{key:0,"onUpdate:modelValue":t=>o.name=t,class:"tag-input",onBlur:t=>(0,p.SU)(n).editingInput(o),onKeyup:(0,i.D2)((e=>(0,p.SU)(n).editingInputMulti(o,(0,p.SU)(l),t.type)),["enter"]),onClick:s[0]||(s[0]=(0,i.iM)((()=>{}),["stop"]))},null,40,v)),[[i.nr,o.name]]):(0,u.kq)("",!0),o.state.weightEditing?(0,u.wy)(((0,u.wg)(),(0,u.iD)("input",{key:1,"onUpdate:modelValue":t=>o.weight=t,class:"tag-input",max:"7",min:"-7",type:"number",onBlur:t=>(0,p.SU)(n).weightInput(o),onKeyup:(0,i.D2)((t=>(0,p.SU)(n).weightInput(o)),["enter"])},null,40,_)),[[i.nr,o.weight]]):(0,u.kq)("",!0),o.state.editing?((0,u.wg)(),(0,u.iD)("div",S,(0,g.zw)(o.name+"1"),1)):((0,u.wg)(),(0,u.iD)("span",x,(0,g.zw)(o.name),1)),o.children?((0,u.wg)(),(0,u.j4)(d,{key:4,children:o.children,index:(0,p.SU)(l).concat([e.children.indexOf(o)]),type:t.type},null,8,["children","index","type"])):(0,u.kq)("",!0)],6)])),_:1},16,["item-key","list"])}}});const U=b;var k=U;const M=(0,u._)("div",null,"提示词",-1),C=(0,u._)("div",null,"反向提示词",-1);var O=(0,u.aZ)({__name:"nested-frame",setup(t){const e=m();return(t,n)=>{const i=h.Kf;return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u.Wm)(i,null,{header:(0,u.w5)((()=>[M])),default:(0,u.w5)((()=>[(0,u.Wm)(k,{children:(0,p.SU)(e).prompt,type:"prompt"},null,8,["children"])])),_:1}),(0,u.Wm)(i,null,{header:(0,u.w5)((()=>[C])),default:(0,u.w5)((()=>[(0,u.Wm)(k,{children:(0,p.SU)(e).promptNeg,type:"promptNeg"},null,8,["children"])])),_:1})],64)}}});const H=O;var E=H,W=n(5781),j=n(4922),N={__name:"App",setup(t){const e=m(),n=(0,p.iH)(!1),i="AI画图标签管理器",h=(0,p.iH)(),f=(0,p.iH)(),y=()=>{(0,p.SU)(f).popperRef?.delayHide?.()},w=["左键","click       启用/禁用","+ Ctr       编辑","+ Alt       权重","+ Ctr + Alt 删除","右键","click       菜单","+ Ctr       添加","+ Alt       添加组","+ Ctr + Alt 切换tag模式","点击下面空白处生成tag"];return(t,m)=>{const v=d.mi,_=s.zi,S=c.OX,x=a.Q2,b=r.$t,U=l.Mr,k=o.zd;return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u.Wm)(_,{offset:120},{default:(0,u.w5)((()=>[(0,u.Wm)(v,{icon:(0,p.SU)(W.I8b),circle:"",type:"primary",onClick:m[0]||(m[0]=t=>n.value=!0)},null,8,["icon"])])),_:1}),(0,u.Wm)(k,{modelValue:n.value,"onUpdate:modelValue":m[2]||(m[2]=t=>n.value=t),title:i,direction:"ltr",size:"90%"},{header:(0,u.w5)((()=>[(0,u.Wm)(x,{wrap:""},{default:(0,u.w5)((()=>[(0,u.Wm)(v,{type:"primary",onClick:(0,p.SU)(e).output},{default:(0,u.w5)((()=>[(0,u.Uk)("输出到webUI")])),_:1},8,["onClick"]),(0,u.Wm)(S,{modelValue:(0,p.SU)(e).config.switch.autoStart.active,"onUpdate:modelValue":m[1]||(m[1]=t=>(0,p.SU)(e).config.switch.autoStart.active=t),"active-text":(0,p.SU)(e).config.switch.autoStart.name,"inactive-text":(0,p.SU)(e).config.switch.autoStart.name,class:"ml-2","inline-prompt":""},null,8,["modelValue","active-text","inactive-text"]),(0,u.wy)(((0,u.wg)(),(0,u.j4)(v,{ref_key:"buttonRef",ref:h},{default:(0,u.w5)((()=>[(0,u.Uk)("帮助")])),_:1})),[[(0,p.SU)(j.Z),y]])])),_:1}),(0,u.Wm)(b,{ref_key:"popoverRef",ref:f,"virtual-ref":h.value,width:200,title:"快捷键",trigger:"click","virtual-triggering":""},{default:(0,u.w5)((()=>[((0,u.wg)(),(0,u.iD)(u.HY,null,(0,u.Ko)(w,(t=>(0,u._)("div",{key:t},(0,g.zw)(t),1))),64))])),_:1},8,["virtual-ref"])])),default:(0,u.w5)((()=>[(0,u.Wm)(U,null,{default:(0,u.w5)((()=>[(0,u.Wm)(E)])),_:1})])),_:1},8,["modelValue"])],64)}}};const I=N;var A=I,K=n(362),V=(n(4415),n(7605));const D=document.createElement("div");D.id="container",document.body.appendChild(D);const T=(0,f.WB)();T.use(V.Z),(0,i.ri)(A).use(K.Z).use(T).mount("#container")}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var l=e[i]={exports:{}};return t[i].call(l.exports,l,l.exports,n),l.exports}n.m=t,function(){var t=[];n.O=function(e,i,o,l){if(!i){var r=1/0;for(d=0;d<t.length;d++){i=t[d][0],o=t[d][1],l=t[d][2];for(var a=!0,c=0;c<i.length;c++)(!1&l||r>=l)&&Object.keys(n.O).every((function(t){return n.O[t](i[c])}))?i.splice(c--,1):(a=!1,l<r&&(r=l));if(a){t.splice(d--,1);var s=o();void 0!==s&&(e=s)}}return e}l=l||0;for(var d=t.length;d>0&&t[d-1][2]>l;d--)t[d]=t[d-1];t[d]=[i,o,l]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,i){var o,l,r=i[0],a=i[1],c=i[2],s=0;if(r.some((function(e){return 0!==t[e]}))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(c)var d=c(n)}for(e&&e(i);s<r.length;s++)l=r[s],n.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return n.O(d)},i=self["webpackChunknoval_tag_model_manage"]=self["webpackChunknoval_tag_model_manage"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(1021)}));i=n.O(i)})();